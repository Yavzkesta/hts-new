---
import { getCollection } from 'astro:content';
import { defaultLang } from '~/i18n/ui';
export async function getStaticPaths() {
  const allGames = await getCollection('game');
  const uniqueSlugs = new Set();
  
  allGames.forEach(game => {
    // Extraire le slug de base (sans le suffixe de langue)
    const baseSlug = game.slug.replace(/-(fr|en)$/, '');
    uniqueSlugs.add(baseSlug);
  });
  return Array.from(uniqueSlugs).map(slug => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;
---

<meta http-equiv="refresh" content={`0;url=/${defaultLang}/games/${slug}`} />

<script define:vars={{ defaultLang, slug }}>
  // Client-side redirection
  window.location.pathname = `/${defaultLang}/games/${slug}`;
</script>
